<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>layui</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../layui/css/layui.css" media="all" />
  <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->
</head>
<body>
  <!-- 显示状态 -->
  <div class="layui-form" >
    

  <div class="layui-form-item spc">
    <label class="layui-form-label">显示状态</label>
    <div class="layui-input-block">
      <input type="checkbox" name="like[write]" title="通过" checked="">
      <input type="checkbox" name="like[read]" title="不通过" >
      <input type="checkbox" name="like[game]" title="替补">
    </div>
  </div> 
  </div>
<table class="layui-hide" id="test" lay-filter="test"></table>
<script type="text/html" id="switchTpl">
  <input type="checkbox" name="sex" value="{{d.is_image}}" lay-skin="switch" lay-text="是|否" lay-filter="sexDemo" {{ d.is_image == 1 ? 'checked' : '' }}>
</script>
<script type="text/html" id="checkboxTpl">
  <input type="checkbox" name="lock" value="{{d.column_name}}" title="显示" lay-filter="lockDemo" {{ d.is_show == 1 ? 'checked' : '' }}>
</script>

              
          
<script type="text/javascript" src="../../layui/layui.all.js"></script>
<!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 --> 
 
<script>
layui.use('table', function(){
  var table = layui.table
  ,form = layui.form;
 layer = parent.layer === undefined ? layui.layer : top.layer,
        $ = layui.jquery,
        laydate = layui.laydate,
        laytpl = layui.laytpl,
        table = layui.table; 
        data_id ='';
 $(function () {
      //从父层获取值，json是父层的全局js变量。eval是将该string类型的json串变为标准的json串
      var parent_json = eval('('+parent.json+')');  
      data_id = parent_json.id;  
      table.render({ 
          elem: '#test'
          ,cellMinWidth: 80
          ,url:'http://apply.imbatv.cn/tool/tournament/setting/'+data_id
          ,cols: [[
            {field:'lock', title:'是否显示',templet: '#checkboxTpl', unresize: true,align: 'center' },
            {field:'default_show_name', title:'默认名称', align: 'center'},
            {field:'column_name', title:'字段名', align: 'center'},
            {field:'show_name', title:'别名',  align: 'center', edit: 'text' }
            ,{field:'img', title:'图片属性', align: 'center', templet: '#switchTpl', unresize: true}
          ]]
          ,
          page: true,
          limit: 20
        }); 
  });

 
  
  //监听图片属性操作
  form.on('switch(sexDemo)', function(obj){
    layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);

  });
  
  //监听显示操作
  form.on('checkbox(lockDemo)', function(obj){
    // console.log(obj); 
    // layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
    table.reload('test', {
      url: 'http://apply.imbatv.cn/tool/tournament/update_tour_item_list/'+data_id
      ,where: { //设定异步数据接口的额外参数，任意设
        item_name: this.value
      }
      ,page: {
        curr: 1 //重新从第 1 页开始
      }
    }); //只重载数据
  });


    //监听单元格编辑
  table.on('edit(test)', function(obj){
    var value = obj.value //得到修改后的值
    ,data = obj.data //得到所在行所有键值
    ,field = obj.field; //得到字段
    layer.msg('[ID: '+ data.id +'] ' + field + ' 字段更改为：'+ value);
  });
});
</script>

</body>
</html>